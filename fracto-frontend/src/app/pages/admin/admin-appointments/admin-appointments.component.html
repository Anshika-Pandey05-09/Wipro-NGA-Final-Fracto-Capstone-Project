<div class="container py-3">
  <h4 class="mb-3">Admin â€¢ Approvals</h4>

  <form [formGroup]="f" class="row g-2 align-items-end mb-3">
    <div class="col-12 col-md-3">
      <label class="form-label">Search (Doctor/Patient)</label>
      <input class="form-control" formControlName="q" placeholder="e.g. Mehta, Riya" />
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">City</label>
      <input class="form-control" formControlName="city" placeholder="City" />
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Status</label>
      <select class="form-select" formControlName="status">
        <option value="">All</option>
        <option value="Pending">Pending</option>
        <option value="Booked">Booked</option>
        <option value="Cancelled">Cancelled</option>
      </select>
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">From</label>
      <input type="date" class="form-control" formControlName="dateFrom" />
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">To</label>
      <input type="date" class="form-control" formControlName="dateTo" />
    </div>
  </form>

  <div *ngIf="loading" class="text-center my-4"><div class="spinner-border"></div></div>
  <div *ngIf="!loading && error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!loading && !error">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <small class="text-muted">Total: {{ total }}</small>
    </div>

    <div class="table-responsive">
      <table class="table align-middle shadow-sm">
        <thead class="table-light">
          <tr>
            <th style="width:52px"></th>
            <th>Doctor</th>
            <th>Patient</th>
            <th>City</th>
            <th>Date</th>
            <th>Slot</th>
            <th>Status</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of rows; trackBy: trackById">
            <td>
              <img [src]="imgUrl(a.doctorProfileImagePath)"
                   
                   class="rounded border" style="width:44px;height:44px;object-fit:cover;" />
            </td>
            <td class="fw-semibold">{{ a.doctorName }}</td>
            <td>{{ a.patientName }}</td>
            <td>{{ a.city }}</td>
            <td>{{ a.appointmentDate | date:'mediumDate' }}</td>
            <td><code>{{ a.timeSlot }}</code></td>
            <td><span [class]="statusClass(a.status)">{{ a.status }}</span></td>
            <td class="text-end">
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" (click)="approve(a)" [disabled]="a.status !== 'Pending'">Approve</button>
                <button class="btn btn-outline-danger" (click)="cancel(a)" [disabled]="!(a.status === 'Pending' || a.status === 'Booked')">Cancel</button>
              </div>
            </td>
          </tr>
          <tr *ngIf="!rows?.length">
            <td colspan="8" class="text-center text-muted py-4">No appointments found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
