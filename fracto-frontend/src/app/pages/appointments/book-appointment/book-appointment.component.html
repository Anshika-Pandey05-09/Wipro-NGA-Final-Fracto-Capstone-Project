<!-- Doctor header -->
<div *ngIf="loadingDoctor" class="text-center my-5">
  <div class="spinner-border" role="status"></div>
</div>

<div *ngIf="!loadingDoctor && doctor">
  <div class="card shadow-sm border-0 mb-3">
    <div class="row g-0 align-items-center">
      <div class="col-auto">
        <img
          [src]="imgUrl(doctor.profileImagePath)"
          class="img-fluid"
          alt="doctor image"
          style="height:110px; width:110px; object-fit:contain; background:#f8f9fa; padding:6px; border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;"
          (error)="onImgError($event)">
      </div>
      <div class="col">
        <div class="card-body py-3">
          <div class="d-flex align-items-center justify-content-between">
            <h4 class="mb-1">{{ doctor.name }}</h4>
            <span *ngIf="doctor.rating != null" class="badge bg-success fs-6">
              {{ doctor.rating | number:'1.1-1' }} ★
            </span>
          </div>
          <div class="text-muted">
            <span class="me-2">{{ specName() }}</span> ·
            <span class="ms-2">{{ doctor.city }}</span>
          </div>
          <div class="mt-2 small text-muted">
            <span *ngIf="doctor.startTime && doctor.endTime">
              Hours: {{ doctor.startTime }}–{{ doctor.endTime }}
            </span>
            <span *ngIf="doctor.slotDurationMinutes" class="ms-3">
              Slot: {{ doctor.slotDurationMinutes }} mins
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Booking card -->
  <div class="card shadow-sm border-0 p-3">
    <h5 class="mb-3">Select date & time</h5>

    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
    <div *ngIf="message" class="alert alert-success">{{ message }}</div>
    <div *ngIf="!isLoggedIn" class="alert alert-warning">
      You’re not logged in. <a routerLink="/login">Login</a> to book an appointment.
    </div>

    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="date"
          [min]="minDate"
          (ngModelChange)="onDateChange()" />
      </div>

      <div class="col-md-3">
        <button class="btn btn-outline-primary mt-3 mt-md-0" (click)="loadSlots()">
          Refresh Slots
        </button>
      </div>
    </div>

    <div class="mt-3" *ngIf="loadingSlots">
      <div class="text-center my-4">
        <div class="spinner-border" role="status"></div>
      </div>
    </div>

    <div class="mt-3" *ngIf="!loadingSlots">
      <div *ngIf="slots.length === 0" class="alert alert-info">
        No slots available for the selected date. Try another date.
      </div>

      <div class="d-flex flex-wrap gap-2">
        <label class="slot-pill" *ngFor="let s of slots">
          <input type="radio" name="slot" [(ngModel)]="selectedSlot" [value]="s" />
          <span>{{ s }}</span>
        </label>
      </div>

      <div class="mt-4">
        <button class="btn btn-success" (click)="book()" [disabled]="!selectedSlot || !isLoggedIn">
          Book Appointment
        </button>
      </div>
    </div>
  </div>
</div>
